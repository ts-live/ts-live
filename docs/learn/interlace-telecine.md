## ここで使う動画

こんな感じで生成する。24fpsテレシネ化、30fpsプログレッシブ、60fpsインターレースの3種類

```bash
#!/bin/bash

function gen_dummy() {
  duration=$1
  fps=$2
  filter=$3
  filename=$4
  extra_args=$5
  frames=$(expr ${duration} \* $(echo ${fps} | sed 's|/| / |g'))
  gen="mptestsrc=duration=${duration}:max_frames=${frames}:rate=${fps}:test=mv"
  agen="anullsrc=duration=${duration}"
  resize="crop=w=256:h=240:x=0:y=0,scale=w=1440:h=1080"

  # onid/tsid/sidは後で書き換えるので適当な値でOK
  ffmpeg -hide_banner \
    -f lavfi -i "${gen}" \
    -f lavfi -i "${agen}" \
    -vf "${resize},${filter},fps=fps=30000/1001" \
    -pix_fmt yuv420p \
    -c:v mpeg2video \
    -c:a aac \
    -f mpegts \
    -mpegts_original_network_id 0x1122 \
    -mpegts_transport_stream_id 0x3344 \
    -mpegts_service_id 0x5566 \
    -metadata service_provider="MyProvider" \
    -metadata service_name="MyChannel" \
    -mpegts_flags +nit \
    -mpegts_m2ts_mode 0 \
    -nit_period 1 \
    ${extra_args} \
    "${filename}" \
    -y
}

duration=300

gen_dummy ${duration} 24 "telecine=first_field=top:pattern=23" 24t.ts "-flags +ilme+ildct"
gen_dummy ${duration} 30 "null"  30p.ts ""
gen_dummy ${duration} 60 "interlace"  60i.ts "-flags +ilme+ildct"
```

## 動画の説明

横方向の白いバーが右から左へ縮んでいくのを繰り返している。
イメージとしてはテキストで書くとこんな感じ。
a:32～a:22として表記する（actual widthみたいな意味）
t:とb:でtop-fieldとbottom-fieldのwidthを表す。
24fpsテレシネ・30fpsプログレッシブ・60fpsインターレースでそれぞれ実時間での移動速度は違うが、フレームとしては進み方が一緒になるようにした。

```plaintext:frame0
*******************************
*******************************
*******************************
*******************************
*******************************
*******************************
```

```plaintext:frame1
*****************************
*****************************
*****************************
*****************************
*****************************
*****************************
```

```plaintext:frame2
***************************
***************************
***************************
***************************
***************************
***************************
```

```plaintext:frame3
*************************
*************************
*************************
*************************
*************************
*************************
```


## インターレース

Top Field Firstで考えると、こんな風に格納されている。

```plaintext:frame0
*******************************
*****************************
*******************************
*****************************
*******************************
*****************************
```

t:32
b:30

a:32とa:30の2フレーム分を重ねてるようなイメージなので、t->bの順番で表示（残りは補完）すると良い

```plaintext:frame1
***************************
*************************
***************************
*************************
***************************
*************************
```

t:28
b:26

a:28とa:26


```plaintext:frame2
***********************
*********************
***********************
*********************
***********************
*********************
```

t:24
b:22

a:24とa:22

```plaintext:frame3
*******************
*****************
*******************
*****************
*******************
*****************
```

t:20
b:18
a:20とa:18

frame0-top -> frame0-bottom -> frame1-top -> frame1-bottom -> frame2-top -> frame2-bottom -> frame3-top -> frame3-bottom
というような順番で表示していくと60fpsになる（解像度は半分）



## テレシネ



```plaintext:frame0
*******************************
*******************************
*******************************
*******************************
*******************************
*******************************
```

a:32
t:32
b:32
そのまま表示すれば良い

```plaintext:frame1
*****************************
*****************************
*****************************
*****************************
*****************************
*****************************
```

a:30
t:30
b:30

そのまま表示すれば良い

```plaintext:frame2(repeated-top)
*****************************
***************************
*****************************
***************************
*****************************
***************************
```

a:28
t:30
b:28

top-fieldが無いのでyadifでtop-fieldを補完する。

```plaintext:frame3
*************************
***********************
*************************
***********************
*************************
***********************
```

a:26
t:26
b:24
bottom-fieldがいきすぎてるのでyadifでbottom-fieldを補完すると画像が出来る、が、どうせ次のフレームで
全部来るからこのフレームをスキップして良い。

```plaintext:frame4(repeated-bottom)
***********************
***********************
***********************
***********************
***********************
***********************
```

a:24
t:24
b:24
そのまま表示すれば良い

```plaintext:frame5
*********************
*********************
*********************
*********************
*********************
*********************
```

a:22
t:22
b:22

repeated-topとrepeated-bottomでそれぞれ奇数・偶数行が前のフレームのままになっている。
repeated-topとrepeated-bottomの間のフレームはズレたまま進む

